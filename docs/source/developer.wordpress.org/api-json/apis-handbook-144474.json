{
    "id": 144474,
    "date": "2022-11-20T19:59:37",
    "date_gmt": "2022-11-20T19:59:37",
    "guid": {
        "rendered": "https://developer.wordpress.org/?post_type=apis-handbook&#038;p=144474"
    },
    "modified": "2023-07-25T11:48:10",
    "modified_gmt": "2023-07-25T11:48:10",
    "slug": "nonces",
    "status": "publish",
    "type": "apis-handbook",
    "link": "https://developer.wordpress.org/apis/security/nonces/",
    "title": {
        "rendered": "Nonces"
    },
    "content": {
        "rendered": "\n<p>A nonce is a &#8220;number used once&#8221; to help protect URLs and forms from certain types of misuse, malicious or otherwise.</p>\n\n\n\n<p>Technically, WordPress nonces aren&#8217;t strictly numbers; they are a hash made up of numbers and letters. Nor are they used only once: they have a limited &#8220;lifetime&#8221; after which they expire. During that time period, the same nonce will be generated for a given user in a given context. The nonce for that action will remain the same for that user until that nonce life cycle has completed.</p>\n\n\n\n<p>WordPress&#8217;s security tokens are called &#8220;nonces&#8221; (despite the above-noted differences from true nonces) because they serve much the same purpose as nonces do. They help protect against several types of attacks including CSRF, but do not protect against replay attacks because they aren&#8217;t checked for one-time use. Nonces should never be relied on for authentication, authorization, or access control. Protect your functions using <code>current_user_can()</code>, and always assume nonces can be compromised.</p>\n\n\n\n<h2 class=\"wp-block-heading\">Why use a nonce?</h2>\n\n\n\n<p>For an example of why a nonce is used, consider that an admin screen might generate a URL like this that trashes post number 123.</p>\n\n\n\n<p><code>http://example.com/wp-admin/post.php?post=123&amp;action=trash</code></p>\n\n\n\n<p>When you go to that URL, WordPress will validate your authentication cookie information and, if you&#8217;re allowed to delete that post, will proceed to delete it. What an attacker can do with this is make your browser go to that URL without your knowledge. For example, the attacker could craft a disguised link on a 3rd party page like this:</p>\n\n\n\n<p><code>&lt;img src=\"http://example.com/wp-admin/post.php?post=123&amp;action=trash\" /&gt;</code></p>\n\n\n\n<p>This would trigger your browser to make a request to WordPress, and the browser would automatically attach your authentication cookie and WordPress would consider this a valid request.</p>\n\n\n\n<p>Adding a nonce would prevent this. For example, when using a nonce, the URLs that WordPress generate for the user look like this:</p>\n\n\n\n<p><code>http://example.com/wp-admin/post.php?post=123&amp;action=trash&amp;_wpnonce=b192fc4204</code></p>\n\n\n\n<p>If anyone attempts to trash post number 123 without having the correct nonce generated by WordPress and given to the user, WordPress will send a &#8220;403 Forbidden&#8221; response to the browser.</p>\n\n\n\n<h2 class=\"wp-block-heading\">Creating a nonce</h2>\n\n\n\n<p>You can create a nonce and add it to the query string in a URL, you can add it in a hidden field in a form, or you can use it some other way.</p>\n\n\n\n<p>For nonces that are to be used in AJAX requests, it is common to add the nonce to a hidden field, from which JavaScript code can fetch it.</p>\n\n\n\n<p>Note that the nonces are unique to the current user&#8217;s session, so if a user logs in or out asynchronously any nonces on the page will no longer be valid.</p>\n\n\n\n<h3 class=\"wp-block-heading\">Customize nonces for guests (non logged-in users)</h3>\n\n\n\n<p>WordPress core, by default, generates the same nonce for guests as they have the same user ID (value\u00a0<code>0</code>). That is, it does not prevent guests from CSRF attacks. To enhance this security aspect for critical actions, you can develop a session mechanism for your guests, and hook to the\u00a0<a href=\"https://developer.wordpress.org/reference/hooks/nonce_user_logged_out/\">nonce_user_logged_out</a>\u00a0filter for replacing the user ID value\u00a0<code>0</code>\u00a0with another random ID from the session mechanism.</p>\n\n\n\n<h3 class=\"wp-block-heading\">Adding a nonce to a URL</h3>\n\n\n\n<p>To add a nonce to a URL, call <code>wp_nonce_url()</code> specifying the bare URL and a string representing the action. For example:</p>\n\n\n\n<pre class=\"wp-block-code has-small-font-size\"><code lang=\"php\" class=\"language-php\">$complete_url = wp_nonce_url( $bare_url, 'trash-post_'.$post-&gt;ID );</code></pre>\n\n\n\n<p>For maximum protection, ensure that the string representing the action is as specific as possible.</p>\n\n\n\n<p>By default, <code>wp_nonce_url()</code> adds a field named <code>_wpnonce</code>. You can specify a different name in the function call. For example:</p>\n\n\n\n<pre class=\"wp-block-code has-small-font-size\"><code lang=\"php\" class=\"language-php\">$complete_url = wp_nonce_url( $bare_url, 'trash-post_'.$post-&gt;ID, 'my_nonce' );</code></pre>\n\n\n\n<h3 class=\"wp-block-heading\">Adding a nonce to a form</h3>\n\n\n\n<p>To add a nonce to a form, call <code>wp_nonce_field()</code> specifying a string representing the action. By default <code>wp_nonce_field()</code> generates two hidden fields, one whose value is the nonce and one whose value is the current URL (the referrer), and it echoes the result. For example, this call:</p>\n\n\n\n<pre class=\"wp-block-code has-small-font-size\"><code lang=\"php\" class=\"language-php\">wp_nonce_field( 'delete-comment_'.$comment_id );</code></pre>\n\n\n\n<p>might echo something like:</p>\n\n\n\n<pre class=\"wp-block-code has-small-font-size\"><code lang=\"php\" class=\"language-php\">&lt;input type=\"hidden\" id=\"_wpnonce\" name=\"_wpnonce\" value=\"796c7766b1\" /&gt;\n&lt;input type=\"hidden\" name=\"_wp_http_referer\" value=\"/wp-admin/edit-comments.php\" /&gt;</code></pre>\n\n\n\n<p>For maximum protection, ensure that the string representing the action is as specific as possible.</p>\n\n\n\n<p>You can specify a different name for the nonce field, you can specify that you do not want a referrer field, and you can specify that you want the result to be returned and not echoed. For details of the syntax, see: <code>wp_nonce_field()</code>.</p>\n\n\n\n<h3 class=\"wp-block-heading\">Creating a nonce for use in some other way</h3>\n\n\n\n<p>To create a nonce for use in some other way, call <code>wp_create_nonce()</code> specifying a string representing the action. For example:</p>\n\n\n\n<pre class=\"wp-block-code has-small-font-size\"><code lang=\"php\" class=\"language-php\">$nonce = wp_create_nonce( 'my-action_'.$post-&gt;ID );</code></pre>\n\n\n\n<p>This simply returns the nonce itself. For example: <code>295a686963</code></p>\n\n\n\n<p>For maximum protection, ensure that the string representing the action is as specific as possible.</p>\n\n\n\n<h3 class=\"wp-block-heading\">Verifying a nonce</h3>\n\n\n\n<p>You can verify a nonce that was passed in a URL, a form in an admin screen, an AJAX request, or in some other context.</p>\n\n\n\n<p>Verifying a nonce passed from an admin screen<br>To verify a nonce that was passed in a URL or a form in an admin screen, call <code>check_admin_referer()</code> specifying the string representing the action.</p>\n\n\n\n<p>For example:</p>\n\n\n\n<pre class=\"wp-block-code has-small-font-size\"><code lang=\"php\" class=\"language-php\">check_admin_referer( 'delete-comment_'.$comment_id );</code></pre>\n\n\n\n<p>This call checks the nonce and the referrer, and if the check fails it takes the normal action (terminating script execution with a &#8220;403 Forbidden&#8221; response and an error message).</p>\n\n\n\n<p>If you did not use the default field name (<code>_wpnonce</code>) when you created the nonce, specify the field name.</p>\n\n\n\n<p>For example:</p>\n\n\n\n<pre class=\"wp-block-code has-small-font-size\"><code lang=\"php\" class=\"language-php\">check_admin_referer( 'delete-comment_'.$comment_id, 'my_nonce' );</code></pre>\n\n\n\n<h3 class=\"wp-block-heading\">Verifying a nonce passed in an AJAX request</h3>\n\n\n\n<p>To verify a nonce that was passed in an AJAX request, call <a href=\"https://developer.wordpress.org/reference/functions/check_ajax_referer/\" rel=\"function\">check_ajax_referer()</a>  specifying the string representing the action. For example:</p>\n\n\n\n<pre class=\"wp-block-code has-small-font-size\"><code lang=\"php\" class=\"language-php\">check_ajax_referer( 'process-comment' );</code></pre>\n\n\n\n<p>This call checks the nonce (but not the referrer), and if the check fails then by default it terminates script execution.</p>\n\n\n\n<p>If you did not use one of the default field names (<code>_wpnonce</code> or <code>_ajax_nonce</code>) when you created the nonce, or if you want to take some other action instead of terminating execution, you can specify additional parameters. For details, see: <code>check_ajax_referer()</code>.</p>\n\n\n\n<p>Verifying a nonce passed in some other context<br>To verify a nonce passed in some other context, call <code>wp_verify_nonce()</code> specifying the nonce and the string representing the action.</p>\n\n\n\n<p>For example:</p>\n\n\n\n<pre class=\"wp-block-code has-small-font-size\"><code lang=\"php\" class=\"language-php\">wp_verify_nonce( $_REQUEST['my_nonce'], 'process-comment'.$comment_id );</code></pre>\n\n\n\n<p>If the result is false, do not continue processing the request. Instead, take some appropriate action. The usual action is to call <code>wp_nonce_ays()</code>, which sends a &#8220;403 Forbidden&#8221; response to the browser.</p>\n\n\n\n<h2 class=\"wp-block-heading\">Modifying the nonce system</h2>\n\n\n\n<p>You can modify the nonce system by adding various actions and filters.</p>\n\n\n\n<h3 class=\"wp-block-heading\">Modifying the nonce lifetime</h3>\n\n\n\n<p>By default, a nonce has a lifetime of one day. After that, the nonce is no longer valid even if it matches the action string. To change the lifetime, add a nonce_life filter specifying the lifetime in seconds.</p>\n\n\n\n<p>For example, to change the lifetime to four hours:</p>\n\n\n\n<pre class=\"wp-block-code has-small-font-size\"><code lang=\"php\" class=\"language-php\">add_filter( 'nonce_life', function () { return 4 * HOUR_IN_SECONDS; } );</code></pre>\n\n\n\n<h3 class=\"wp-block-heading\">Performing additional verification</h3>\n\n\n\n<p>To perform additional verification when <code>check_admin_referrer()</code> has found that the nonce and the referrer are valid, add a <code>check_admin_referer</code> action.</p>\n\n\n\n<p>For example:</p>\n\n\n\n<pre class=\"wp-block-code has-small-font-size\"><code lang=\"php\" class=\"language-php\">function wporg_additional_check ( $action, $result ) {\n    ...\n}\nadd_action( 'check_admin_referer', 'wporg_additional_check', 10, 2 );</code></pre>\n\n\n\n<p>For <code>check_ajax_referer()</code> add a <code>check_ajax_referer</code> action in the same way.</p>\n\n\n\n<h3 class=\"wp-block-heading\">Changing the error message</h3>\n\n\n\n<p>You can change the error message sent when a nonce is not valid, by using the translation system. For example:</p>\n\n\n\n<pre class=\"wp-block-code has-small-font-size\"><code lang=\"php\" class=\"language-php\">function my_nonce_message ($translation) {\n    if ($translation === 'Are you sure you want to do this?') {\n       return 'No! No! No!';\n    } \n\n    return $translation;\n}\n\nadd_filter('gettext', 'my_nonce_message');</code></pre>\n\n\n\n<h2 class=\"wp-block-heading\">Additional information</h2>\n\n\n\n<p>This section contains additional information about the nonce system in WordPress that might occasionally be useful.</p>\n\n\n\n<h3 class=\"wp-block-heading\">Nonce lifetime</h3>\n\n\n\n<p>Note that just as a WordPress nonce is not &#8220;a number used once&#8221;, nonce lifetime isn&#8217;t really nonce lifetime. WordPress uses a system with two ticks (half of the lifetime) and validates nonces from the current tick and the last tick. In default settings (24h lifetime) this means that the time information in the nonce is related to how many 12h periods of time have passed since the Unix epoch. This means that a nonce made between midday and midnight will have a lifetime until midday the next day. The actual lifetime is thus variable between 12 and 24 hours.</p>\n\n\n\n<p>When a nonce is valid, the functions that validate nonces return the current tick number, 1 or 2. You could use this information, for example, to refresh nonces that are in their second tick so that they do not expire.</p>\n\n\n\n<h3 class=\"wp-block-heading\">Nonce security</h3>\n\n\n\n<p>Nonces are generated using a key and salt that are unique to your site if you have installed WordPress correctly. <code>NONCE_KEY</code> and <code>NONCE_SALT</code> are defined in your <code>wp-config.php</code> file, and the file contains comments that provide more information.</p>\n\n\n\n<p>Nonces should never be relied on for authentication or authorization, or for access control. Protect your functions using <code>current_user_can()</code>, always assume Nonces can be compromised.</p>\n\n\n\n<h3 class=\"wp-block-heading\">Replacing the nonce system</h3>\n\n\n\n<p>Some of the functions that make up the nonce system are pluggable so that you can replace them by supplying your own functions.</p>\n\n\n\n<p>To change the way admin requests or AJAX requests are verified, you can replace <code>check_admin_referrer()</code> or <code>check_ajax_referrer()</code>, or both.</p>\n\n\n\n<p>To replace the nonce system with some other nonce system, you can replace <code>wp_create_nonce()</code>, <code>wp_verify_nonce()</code> and <code>wp_nonce_tick()</code>.</p>\n\n\n\n<h3 class=\"wp-block-heading\">Related</h3>\n\n\n\n<p>Nonce functions: <code>wp_nonce_ays()</code>, <code>wp_nonce_field()</code>, <code>wp_nonce_url()</code>, <code>wp_verify_nonce()</code>, <code>wp_create_nonce()</code>, <code>check_admin_referer()</code>, <code>check_ajax_referer()</code>, <code>wp_referer_field()</code></p>\n\n\n\n<p>Nonce hooks: <code>nonce_life</code>, <code>nonce_user_logged_out</code>, <code>explain_nonce_(verb)-(noun)</code>, <code>check_admin_referer</code></p>\n",
        "protected": false
    },
    "author": 7756733,
    "featured_media": 0,
    "parent": 144458,
    "menu_order": 40,
    "template": "",
    "meta": {
        "footnotes": ""
    },
    "class_list": [
        "post-144474",
        "apis-handbook",
        "type-apis-handbook",
        "status-publish",
        "hentry",
        "type-handbook"
    ],
    "revision_note": "",
    "jetpack_sharing_enabled": true,
    "_links": {
        "self": [
            {
                "href": "https://developer.wordpress.org/wp-json/wp/v2/apis-handbook/144474",
                "targetHints": {
                    "allow": [
                        "GET"
                    ]
                }
            }
        ],
        "collection": [
            {
                "href": "https://developer.wordpress.org/wp-json/wp/v2/apis-handbook"
            }
        ],
        "about": [
            {
                "href": "https://developer.wordpress.org/wp-json/wp/v2/types/apis-handbook"
            }
        ],
        "author": [
            {
                "embeddable": true,
                "href": "https://developer.wordpress.org/wp-json/wp/v2/users/7756733"
            }
        ],
        "version-history": [
            {
                "count": 5,
                "href": "https://developer.wordpress.org/wp-json/wp/v2/apis-handbook/144474/revisions"
            }
        ],
        "predecessor-version": [
            {
                "id": 147760,
                "href": "https://developer.wordpress.org/wp-json/wp/v2/apis-handbook/144474/revisions/147760"
            }
        ],
        "up": [
            {
                "embeddable": true,
                "href": "https://developer.wordpress.org/wp-json/wp/v2/apis-handbook/144458"
            }
        ],
        "wp:attachment": [
            {
                "href": "https://developer.wordpress.org/wp-json/wp/v2/media?parent=144474"
            }
        ],
        "curies": [
            {
                "name": "wp",
                "href": "https://api.w.org/{rel}",
                "templated": true
            }
        ]
    }
}