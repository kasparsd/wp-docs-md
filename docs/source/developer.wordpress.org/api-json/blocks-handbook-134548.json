{
    "id": 134548,
    "date": "2021-03-09T08:38:23",
    "date_gmt": "2021-03-09T08:38:23",
    "guid": {
        "rendered": "https://developer.wordpress.org/block-editor/reference-guides/packages/packages-dependency-extraction-webpack-plugin/"
    },
    "modified": "2024-10-30T16:55:27",
    "modified_gmt": "2024-10-30T16:55:27",
    "slug": "packages-dependency-extraction-webpack-plugin",
    "status": "publish",
    "type": "blocks-handbook",
    "link": "https://developer.wordpress.org/block-editor/reference-guides/packages/packages-dependency-extraction-webpack-plugin/",
    "title": {
        "rendered": "@wordpress/dependency-extraction-webpack-plugin"
    },
    "content": {
        "rendered": "<p>This webpack plugin serves two purposes:</p>\n<ul>\n<li>Externalize dependencies that are available as shared scripts or modules on WordPress sites.</li>\n<li>Add an asset file for each entry point that declares an object with the list of WordPress script or module dependencies for the entry point. The asset file also contains the current version calculated for the current source code.</li>\n</ul>\n<p>This allows JavaScript bundles produced by webpack to leverage WordPress style dependency sharing without an error-prone process of manually maintaining a dependency list.</p>\n<p>Version 5 of this plugin adds support for module bundling. <a href=\"https://webpack.js.org/configuration/output/#outputmodule\">Webpack&#8217;s <code>output.module</code> option</a> should<br />\nbe used to opt-in to this behavior. This plugin will adapt it&#8217;s behavior based on the<br />\n<code>output.module</code> option, producing an asset file suitable for use with the WordPress Module API.</p>\n<p>Consult the <a href=\"https://webpack.js.org\">webpack website</a> for additional information on webpack concepts.</p>\n<h2>Installation</h2>\n<p>Install the module</p>\n<pre><code class=\"language-bash\">npm install @wordpress/dependency-extraction-webpack-plugin --save-dev\n</code></pre>\n<p><strong>Note</strong>: This package requires Node.js version with long-term support status (check <a href=\"https://nodejs.org/en/about/previous-releases\">Active LTS or Maintenance LTS releases</a>). It also requires webpack 5.0.0 or newer. It is not compatible with older versions.</p>\n<h2>Usage</h2>\n<h3>Webpack</h3>\n<p>Use this plugin as you would other webpack plugins:</p>\n<pre><code class=\"language-js\">// webpack.config.js\nconst DependencyExtractionWebpackPlugin = require( '@wordpress/dependency-extraction-webpack-plugin' );\n\nmodule.exports = {\n    // \u2026snip\n    plugins: [ new DependencyExtractionWebpackPlugin() ],\n};\n</code></pre>\n<p><strong>Note:</strong> Multiple instances of the plugin are not supported and may produced unexpected results. If you plan to extend the webpack configuration from <code>@wordpress/scripts</code> with your own <code>DependencyExtractionWebpackPlugin</code>, be sure to remove the default instance of the plugin:</p>\n<pre><code class=\"language-js\">const defaultConfig = require( '@wordpress/scripts/config/webpack.config' );\nconst webpackConfig = {\n    ...defaultConfig,\n    plugins: [\n        ...defaultConfig.plugins.filter(\n            ( plugin ) =&gt;\n                plugin.constructor.name !== 'DependencyExtractionWebpackPlugin'\n        ),\n        new DependencyExtractionWebpackPlugin( {\n            injectPolyfill: true,\n            requestToExternal( request ) {\n                /* My externals */\n            },\n        } ),\n    ],\n};\n</code></pre>\n<h3>Behavior with scripts</h3>\n<p>Each entry point in the webpack bundle will include an asset file that declares the WordPress script dependencies that should be enqueued. This file also contains the unique version hash calculated based on the file content.</p>\n<p>For example:</p>\n<pre><code>// Source file entrypoint.js\nimport { Component } from 'react';\n\n// Webpack will produce the output output/entrypoint.js\n/* bundled JavaScript output */\n\n// Webpack will also produce output/entrypoint.asset.php declaring script dependencies\n&lt;?php return array('dependencies' =&gt; array('react'), 'version' =&gt; 'dd4c2dc50d046ed9d4c063a7ca95702f');\n</code></pre>\n<p>By default, the following module requests are handled:</p>\n<table>\n<thead>\n<tr>\n<th>Request</th>\n<th>Global</th>\n<th>Script handle</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>@babel/runtime/regenerator</code></td>\n<td><code>regeneratorRuntime</code></td>\n<td><code>wp-polyfill</code></td>\n</tr>\n<tr>\n<td><code>@wordpress/*</code></td>\n<td><code>wp['*']</code></td>\n<td><code>wp-*</code></td>\n</tr>\n<tr>\n<td><code>jquery</code></td>\n<td><code>jQuery</code></td>\n<td><code>jquery</code></td>\n</tr>\n<tr>\n<td><code>lodash-es</code></td>\n<td><code>lodash</code></td>\n<td><code>lodash</code></td>\n</tr>\n<tr>\n<td><code>lodash</code></td>\n<td><code>lodash</code></td>\n<td><code>lodash</code></td>\n</tr>\n<tr>\n<td><code>moment</code></td>\n<td><code>moment</code></td>\n<td><code>moment</code></td>\n</tr>\n<tr>\n<td><code>react-dom</code></td>\n<td><code>ReactDOM</code></td>\n<td><code>react-dom</code></td>\n</tr>\n<tr>\n<td><code>react</code></td>\n<td><code>React</code></td>\n<td><code>react</code></td>\n</tr>\n</tbody>\n</table>\n<p><strong>Note:</strong> This plugin overlaps with the functionality provided by <a href=\"https://webpack.js.org/configuration/externals\">webpack <code>externals</code></a>. This plugin is intended to extract script handles from bundle compilation so that a list of script dependencies does not need to be manually maintained. If you don&#8217;t need to extract a list of script dependencies, use the <code>externals</code> option directly.</p>\n<p>This plugin is compatible with <code>externals</code>, but they may conflict. For example, adding <code>{ externals: { '@wordpress/blob': 'wp.blob' } }</code> to webpack configuration will effectively hide the <code>@wordpress/blob</code> module from the plugin and it will not be included in dependency lists.</p>\n<h3>Behavior with script modules</h3>\n<p><strong>Warning:</strong> Script modules support is considered experimental at this time.</p>\n<p>This section describes the behavior of this package to bundle ECMAScript modules and generate asset<br />\nfiles suitable for use with the WordPress Script Modules API.</p>\n<p>Some of this plugin&#8217;s options change, and webpack requires configuration to output script modules. Refer to<br />\n<a href=\"https://webpack.js.org/configuration/output/#outputmodule\">webpack&#8217;s documentation</a> for up-to-date details.</p>\n<pre><code class=\"language-js\">const webpackConfig = {\n    ...defaultConfig,\n\n    // These lines are necessary to enable module compilation at time-of-writing:\n    output: { module: true },\n    experiments: { outputModule: true },\n\n    plugins: [\n        ...defaultConfig.plugins.filter(\n            ( plugin ) =&gt;\n                plugin.constructor.name !== 'DependencyExtractionWebpackPlugin'\n        ),\n        new DependencyExtractionWebpackPlugin( {\n            // With modules, use `requestToExternalModule`:\n            requestToExternalModule( request ) {\n                if ( request === 'my-registered-module' ) {\n                    return request;\n                }\n            },\n        } ),\n    ],\n};\n</code></pre>\n<p>Each entry point in the webpack bundle will include an asset file that declares the WordPress script module dependencies that should be enqueued. This file also contains the unique version hash calculated based on the file content.</p>\n<p>For example:</p>\n<pre><code>// Source file entrypoint.js\nimport { store, getContext } from '@wordpress/interactivity';\n\n// Webpack will produce the output output/entrypoint.js\n/* bundled JavaScript output */\n\n// Webpack will also produce output/entrypoint.asset.php declaring script dependencies\n&lt;?php return array('dependencies' =&gt; array('@wordpress/interactivity'), 'version' =&gt; 'dd4c2dc50d046ed9d4c063a7ca95702f');\n</code></pre>\n<p>By default, the following script module requests are handled:</p>\n<table>\n<thead>\n<tr>\n<th>Request</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>@wordpress/interactivity</code></td>\n</tr>\n</tbody>\n</table>\n<p>(<code>@wordpress/interactivity</code> is currently the only available WordPress script module.)</p>\n<p><strong>Note:</strong> This plugin overlaps with the functionality provided by <a href=\"https://webpack.js.org/configuration/externals\">webpack <code>externals</code></a>. This plugin is intended to extract script module identifiers from bundle compilation so that a list of script module dependencies does not need to be manually maintained. If you don&#8217;t need to extract a list of script module dependencies, use the <code>externals</code> option directly.</p>\n<p>This plugin is compatible with <code>externals</code>, but they may conflict. For example, adding <code>{ externals: { '@wordpress/blob': 'wp.blob' } }</code> to webpack configuration will effectively hide the <code>@wordpress/blob</code> module from the plugin and it will not be included in dependency lists.</p>\n<h4>Options</h4>\n<p>An object can be passed to the constructor to customize the behavior, for example:</p>\n<pre><code class=\"language-js\">module.exports = {\n    plugins: [\n        new DependencyExtractionWebpackPlugin( { injectPolyfill: true } ),\n    ],\n};\n</code></pre>\n<h5><code>outputFormat</code></h5>\n<ul>\n<li>Type: string</li>\n<li>Default: <code>php</code></li>\n</ul>\n<p>The output format for the generated asset file. There are two options available: &#8216;php&#8217; or &#8216;json&#8217;.</p>\n<h5><code>outputFilename</code></h5>\n<ul>\n<li>Type: string | function</li>\n<li>Default: null</li>\n</ul>\n<p>The filename for the generated asset file. Accepts the same values as the Webpack <code>output.filename</code> option.</p>\n<h5><code>combineAssets</code></h5>\n<ul>\n<li>Type: boolean</li>\n<li>Default: <code>false</code></li>\n</ul>\n<p>By default, one asset file is created for each entry point. When this flag is set to <code>true</code>, all information about assets is combined into a single <code>assets.(json|php)</code> file generated in the output directory.</p>\n<h5><code>combinedOutputFile</code></h5>\n<ul>\n<li>Type: string</li>\n<li>Default: <code>null</code></li>\n</ul>\n<p>This option is useful only when the <code>combineAssets</code> option is enabled. It allows providing a custom output file for the generated single assets file. It&#8217;s possible to provide a path that is relative to the output directory.</p>\n<h5><code>useDefaults</code></h5>\n<ul>\n<li>Type: boolean</li>\n<li>Default: <code>true</code></li>\n</ul>\n<p>Pass <code>useDefaults: false</code> to disable the default request handling.</p>\n<h5><code>injectPolyfill</code></h5>\n<ul>\n<li>Type: boolean</li>\n<li>Default: <code>false</code></li>\n</ul>\n<p>Force <code>wp-polyfill</code> to be included in each entry point&#8217;s dependency list. This would be the same as adding <code>import '@wordpress/polyfill';</code> to each entry point.</p>\n<p><strong>Note</strong>: This option is not available with script modules.</p>\n<h5><code>externalizedReport</code></h5>\n<ul>\n<li>Type: boolean | string</li>\n<li>Default: <code>false</code></li>\n</ul>\n<p>Report all externalized dependencies as an array in JSON format. It could be used for further manual or automated inspection.<br />\nYou can provide a filename, or set it to <code>true</code> to report to a default <code>externalized-dependencies.json</code>.</p>\n<h5><code>requestToExternal</code></h5>\n<p><strong>Note</strong>: This option is not available with script modules. See <a href=\"#requestToExternalModule\"><code>requestToExternalModule</code></a> for module usage.</p>\n<ul>\n<li>Type: function</li>\n</ul>\n<p><code>requestToExternal</code> allows the module handling to be customized. The function should accept a module request string and may return a string representing the global variable to use. An array of strings may be used to access globals via an object path, e.g. <code>wp.i18n</code> may be represented as <code>[ 'wp', 'i18n' ]</code>.</p>\n<p><code>requestToExternal</code> provided via configuration has precedence over default external handling. Unhandled requests will be handled by the default unless <code>useDefaults</code> is set to <code>false</code>.</p>\n<pre><code class=\"language-js\">/**\n * Externalize 'my-module'\n *\n * @param {string} request Requested module\n *\n * @return {(string|undefined)} Script global\n */\nfunction requestToExternal( request ) {\n    // Handle imports like `import myModule from 'my-module'`\n    if ( request === 'my-module' ) {\n        // Expect to find `my-module` as myModule in the global scope:\n        return 'myModule';\n    }\n}\n\nmodule.exports = {\n    plugins: [ new DependencyExtractionWebpackPlugin( { requestToExternal } ) ],\n};\n</code></pre>\n<h5><code>requestToExternalModule</code></h5>\n<p><strong>Note</strong>: This option is only available with script modules. See <a href=\"#requestToExternal\"><code>requestToExternal</code></a> for script usage.</p>\n<ul>\n<li>Type: function</li>\n</ul>\n<p><code>requestToExternalModule</code> allows the script module handling to be customized. The function should accept a script module request string and may return a string representing the script module to use. Often, the script module will have the same name.</p>\n<p><code>requestToExternalModule</code> provided via configuration has precedence over default external handling. Unhandled requests will be handled by the default unless <code>useDefaults</code> is set to <code>false</code>.</p>\n<pre><code class=\"language-js\">/**\n * Externalize 'my-module'\n *\n * @param {string} request Requested script module\n *\n * @return {(string|boolean|undefined)} Script module ID\n */\nfunction requestToExternalModule( request ) {\n    // Handle imports like `import myModule from 'my-module'`\n    if ( request === 'my-module' ) {\n        // Import should be of the form `import { something } from \"myModule\";` in the final bundle.\n        return 'myModule';\n    }\n\n    // If the script module ID in source is the same as the external script module, `true` can be returned.\n    return request === 'external-module-id-no-change-required';\n}\n\nmodule.exports = {\n    plugins: [\n        new DependencyExtractionWebpackPlugin( { requestToExternalModule } ),\n    ],\n};\n</code></pre>\n<h5><code>requestToHandle</code></h5>\n<p><strong>Note</strong>: This option is not available with script modules. It has no corresponding module configuration.</p>\n<ul>\n<li>Type: function</li>\n</ul>\n<p>All of the external modules handled by the plugin are expected to be WordPress script dependencies<br />\nand will be added to the dependency list. <code>requestToHandle</code> allows the script handle included in the dependency list to be customized.</p>\n<p>If no string is returned, the script handle is assumed to be the same as the request.</p>\n<p><code>requestToHandle</code> provided via configuration has precedence over the defaults. Unhandled requests will be handled by the default unless <code>useDefaults</code> is set to <code>false</code>.</p>\n<pre><code class=\"language-js\">/**\n * Map 'my-module' request to 'my-module-script-handle'\n *\n * @param {string} request Requested module\n *\n * @return {(string|undefined)} Script global\n */\nfunction requestToHandle( request ) {\n    // Handle imports like `import myModule from 'my-module'`\n    if ( request === 'my-module' ) {\n        // `my-module` depends on the script with the 'my-module-script-handle' handle.\n        return 'my-module-script-handle';\n    }\n}\n\nmodule.exports = {\n    plugins: [ new DependencyExtractionWebpackPlugin( { requestToHandle } ) ],\n};\n</code></pre>\n<h5><code>requestToExternal</code> and <code>requestToHandle</code></h5>\n<p>The functions <code>requestToExternal</code> and <code>requestToHandle</code> allow this module to handle arbitrary modules.</p>\n<p><code>requestToExternal</code> is necessary to handle any module and maps a module request to a global name.</p>\n<p><code>requestToHandle</code> maps the same module request to a script handle, the strings that will be included in the <code>entrypoint.asset.php</code> files.</p>\n<h3>WordPress</h3>\n<p>Enqueue your script as usual and read the script dependencies dynamically:</p>\n<pre><code class=\"language-php\">$script_path       = 'path/to/script.js';\n$script_asset_path = 'path/to/script.asset.php';\n$script_asset      = file_exists( $script_asset_path )\n    ? require( $script_asset_path )\n    : array( 'dependencies' =&gt; array(), 'version' =&gt; filemtime( $script_path ) );\n$script_url = plugins_url( $script_path, __FILE__ );\nwp_enqueue_script( 'script', $script_url, $script_asset['dependencies'], $script_asset['version'] );\n</code></pre>\n<p>Or with modules (the Script Module API is only available in WordPress &gt; 6.5):</p>\n<pre><code class=\"language-php\">$module_path       = 'path/to/module.js';\n$module_asset_path = 'path/to/module.asset.php';\n$module_asset      = file_exists( $module_asset_path )\n    ? require( $module_asset_path )\n    : array( 'dependencies' =&gt; array(), 'version' =&gt; filemtime( $module_path ) );\n$module_url = plugins_url( $module_path, __FILE__ );\nwp_register_script_module( 'my-module', $module_url, $module_asset['dependencies'], $module_asset['version'] );\nwp_enqueue_script_module( 'my-module' );\n</code></pre>\n<h2>Contributing to this package</h2>\n<p>This is an individual package that&#8217;s part of the Gutenberg project. The project is organized as a monorepo. It&#8217;s made up of multiple self-contained software packages, each with a specific purpose. The packages in this monorepo are published to <a href=\"https://www.npmjs.com/\">npm</a> and used by <a href=\"https://make.wordpress.org/core/\">WordPress</a> as well as other software projects.</p>\n<p>To find out more about contributing to this package or Gutenberg as a whole, please read the project&#8217;s main <a href=\"https://github.com/WordPress/gutenberg/tree/HEAD/CONTRIBUTING.md\">contributor guide</a>.</p>\n",
        "protected": false
    },
    "author": 0,
    "featured_media": 0,
    "parent": 134521,
    "menu_order": 265,
    "template": "",
    "meta": {
        "footnotes": ""
    },
    "class_list": [
        "post-134548",
        "blocks-handbook",
        "type-blocks-handbook",
        "status-publish",
        "hentry",
        "type-handbook"
    ],
    "revision_note": "",
    "jetpack_sharing_enabled": true,
    "_links": {
        "self": [
            {
                "href": "https://developer.wordpress.org/wp-json/wp/v2/blocks-handbook/134548",
                "targetHints": {
                    "allow": [
                        "GET"
                    ]
                }
            }
        ],
        "collection": [
            {
                "href": "https://developer.wordpress.org/wp-json/wp/v2/blocks-handbook"
            }
        ],
        "about": [
            {
                "href": "https://developer.wordpress.org/wp-json/wp/v2/types/blocks-handbook"
            }
        ],
        "version-history": [
            {
                "count": 15,
                "href": "https://developer.wordpress.org/wp-json/wp/v2/blocks-handbook/134548/revisions"
            }
        ],
        "predecessor-version": [
            {
                "id": 153852,
                "href": "https://developer.wordpress.org/wp-json/wp/v2/blocks-handbook/134548/revisions/153852"
            }
        ],
        "up": [
            {
                "embeddable": true,
                "href": "https://developer.wordpress.org/wp-json/wp/v2/blocks-handbook/134521"
            }
        ],
        "wp:attachment": [
            {
                "href": "https://developer.wordpress.org/wp-json/wp/v2/media?parent=134548"
            }
        ],
        "curies": [
            {
                "name": "wp",
                "href": "https://api.w.org/{rel}",
                "templated": true
            }
        ]
    }
}